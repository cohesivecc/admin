
class window.CohesiveAdmin
  @config       = null
  @initialized  = false

  @initialize: () ->
    # NEAL: this feels a bit hacky - on login screen, the AJAX call below causes CSRF validation to fail, so we simply skip this step on that page.
    unless $('body#login').length
      if(CohesiveAdmin.initialized)
        $(document).trigger('cohesive_admin.initialized')
      else
        # side navigation
        $(".button-collapse").sideNav()

        $.ajax({
          url: "<%= CohesiveAdmin::Engine.routes.url_helpers.config_path(format: :json) %>",
          dataType: 'json',
        }).done( (data) ->
          CohesiveAdmin.configure(data);
        )

  @configure: (@config) ->
    # listen for dynamic changes to the form
    $(document).on('cohesive_admin.form_change', () ->
      CohesiveAdmin.refreshForm()
    )
    $(document).on('cohesive_admin.initialized', () ->
      CohesiveAdmin.refreshForm()
    )
    CohesiveAdmin.initialized = true
    # publish initialize event
    $(document).trigger('cohesive_admin.initialized')

  @refreshForm: () ->
    if($('#object-form, #filter-form').length)
      $('#object-form select, #filter-form select').material_select()
      $('#object-form .collapsible').collapsible()
      Materialize.updateTextFields()
      $('#object-form textarea.wysiwyg').froalaEditor()
